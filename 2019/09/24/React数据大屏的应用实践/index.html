<!DOCTYPE html>


  <html class="light page-post">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>React数据大屏的应用实践 | Hzzly</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="随笔,react,大屏,">
  

  <meta name="description" content="数据大屏与数据可视化现如今大数据已无所不在，并且正被越来越广泛的被应用到历史、政治、科学、经济、商业甚至渗透到我们生活的方方面面中，获取的渠道也越来越便利。 今天我们就来聊一聊“大屏应用”，说到大屏就一定要聊到数据可视化，现如今，数据可视化由于数据分析的火热也变得火热起来，不过数据可视化并不是一个新技术，可视化数据就是用可视化的方式展现的数据。而数据大屏作为大数据展示媒介的一种，广泛运用于各种展示">
<meta name="keywords" content="随笔,react,大屏">
<meta property="og:type" content="article">
<meta property="og:title" content="React数据大屏的应用实践">
<meta property="og:url" content="http://yoursite.com/2019/09/24/React数据大屏的应用实践/index.html">
<meta property="og:site_name" content="Hzzly">
<meta property="og:description" content="数据大屏与数据可视化现如今大数据已无所不在，并且正被越来越广泛的被应用到历史、政治、科学、经济、商业甚至渗透到我们生活的方方面面中，获取的渠道也越来越便利。 今天我们就来聊一聊“大屏应用”，说到大屏就一定要聊到数据可视化，现如今，数据可视化由于数据分析的火热也变得火热起来，不过数据可视化并不是一个新技术，可视化数据就是用可视化的方式展现的数据。而数据大屏作为大数据展示媒介的一种，广泛运用于各种展示">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hzzly/hzzly.github.io/master/images/bi/img2.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/hzzly/hzzly.github.io/master/images/bi/img2.png">
<meta property="og:updated_time" content="2019-09-23T18:20:34.107Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React数据大屏的应用实践">
<meta name="twitter:description" content="数据大屏与数据可视化现如今大数据已无所不在，并且正被越来越广泛的被应用到历史、政治、科学、经济、商业甚至渗透到我们生活的方方面面中，获取的渠道也越来越便利。 今天我们就来聊一聊“大屏应用”，说到大屏就一定要聊到数据可视化，现如今，数据可视化由于数据分析的火热也变得火热起来，不过数据可视化并不是一个新技术，可视化数据就是用可视化的方式展现的数据。而数据大屏作为大数据展示媒介的一种，广泛运用于各种展示">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hzzly/hzzly.github.io/master/images/bi/img2.gif">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38189205-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  

</head>
</html>
<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/archives/" rel="noopener noreferrer" target="_self">
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/tag/" rel="noopener noreferrer" target="_self">
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/link/" rel="noopener noreferrer" target="_self">
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/about/" rel="noopener noreferrer" target="_self">
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/atom.xml" rel="noopener noreferrer" target="_blank">
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/search/" rel="noopener noreferrer" target="_self">
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据大屏与数据可视化"><span class="toc-text">数据大屏与数据可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#技术选型"><span class="toc-text">技术选型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统搭建"><span class="toc-text">系统搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#图表选择"><span class="toc-text">图表选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据请求推送"><span class="toc-text">数据请求推送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#布局"><span class="toc-text">布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目结构"><span class="toc-text">项目结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#知识点"><span class="toc-text">知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chart基础组件封装"><span class="toc-text">Chart基础组件封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket封装SDK"><span class="toc-text">Socket封装SDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态数字展示"><span class="toc-text">动态数字展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#背景线性粒子"><span class="toc-text">背景线性粒子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#说明"><span class="toc-text">说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码"><span class="toc-text">源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-React数据大屏的应用实践" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">React数据大屏的应用实践</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2019.09.24</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>hzzly</span>
        </span>
      

      


      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="数据大屏与数据可视化"><a href="#数据大屏与数据可视化" class="headerlink" title="数据大屏与数据可视化"></a>数据大屏与数据可视化</h2><p>现如今大数据已无所不在，并且正被越来越广泛的被应用到历史、政治、科学、经济、商业甚至渗透到我们生活的方方面面中，获取的渠道也越来越便利。</p>
<p>今天我们就来聊一聊“大屏应用”，说到大屏就一定要聊到数据可视化，现如今，数据可视化由于数据分析的火热也变得火热起来，不过数据可视化并不是一个新技术，可视化数据就是用可视化的方式展现的数据。而数据大屏作为大数据展示媒介的一种，广泛运用于各种展示厅、会展、发布会及各种狂欢节中，其中不乏一些通用的处理方案：阿里的DataV、百度的Suger、腾讯RayData等等。</p>
<p>随着物联网、5G等各种跟连接有关的技术的出现与发展，每个人手中掌握的数据量都呈指数级增长，光看这些数是看不过来也看不懂的，“数据可视化”就是一种简化，让艰难的数据理解过程，变成——看颜色，辨长短，分高低。从而大大缩短理解数据所需的时间。</p>
<p>因公司的自研产品涉及到BI模块，因此数据大屏展示的需求孕育而生（数据大屏需求已经完成）。</p>
<p>下面是本人针对这个数据大屏需求前期做的一些探索实践，数据也是mock的。</p>
<p><img src="https://raw.githubusercontent.com/hzzly/hzzly.github.io/master/images/bi/img2.gif" alt="bi"></p>
<h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ul>
<li>React 全家桶（React-Router、React-Redux、React Hooks）</li>
<li>Webpack 编译打包</li>
<li>Echarts 图表组件</li>
<li>Socket.IO 即时通讯、通知与消息推送</li>
<li>Grid 网格布局</li>
</ul>
<h2 id="系统搭建"><a href="#系统搭建" class="headerlink" title="系统搭建"></a>系统搭建</h2><h3 id="图表选择"><a href="#图表选择" class="headerlink" title="图表选择"></a>图表选择</h3><p>六种基本图表涵盖了大部分图表使用场景，也是做数据可视化最常用的图表类型：</p>
<ul>
<li><strong>柱状图</strong> 用来反映分类项目之间的比较；</li>
<li><strong>饼图</strong> 用来反映构成，即部分占总体的比例；</li>
<li><strong>折线图</strong> 用来反映随时间变化的趋势；</li>
<li><strong>条形图</strong> 用来反映分类项目之间的比较；</li>
<li><strong>散点图</strong> 用来反映相关性或分布关系；</li>
<li><strong>地图</strong> 用来反映区域之间的分类比较。</li>
</ul>
<p>基本图表类型都有通用的样式，不过多的展开讲解。我们更多的考虑如何选择常用图表来呈现数据，达到数据可视化的目标。基本方法：<strong>明确目标</strong> —&gt; <strong>选择图形</strong> —&gt; <strong>梳理维度</strong> —&gt; <strong>突出关键信息</strong>。</p>
<h3 id="数据请求推送"><a href="#数据请求推送" class="headerlink" title="数据请求推送"></a>数据请求推送</h3><p>当信息一旦准备就绪，我们就需要从服务器获取它们。这里我们需要一种基于推送的方法，例如 WebSocket 协议、轮询、服务器推送事件（SSE）以及最近的 HTTP2 服务器推送。这里我们简单比较一下 WebSocket 与轮询。</p>
<p>轮询需要客户端定时向服务器发送ajax请求，服务器接到请求后返回响应信息。这就需要大量的占据服务器资源。同时在HTTP1.x协议中也存在一些比如线头阻塞、头部冗余等问题。所以这种方案直接pass了。</p>
<p>再来说说 WebSocket，建立在 TCP 协议之上，数据格式比较轻量，性能开销小，通信高效，可以发送文本，也可以发送二进制数据。同时它还没有同源限制，客户端可以与任意服务器通信。还有一点 WebSocket 通常不使用 XMLHttpRequest，因此，当我们每次需要从服务器获取更多的信息时，无需发送头部数据。反过来说，这又减少了数据发送到服务器时需要付出的高昂的数据负载代价。对于数据大屏需要实时获取数据，这无疑是最高效的。</p>
<h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><p>数据大屏的核心就是数据的拼接，具体到展示层可以归纳成数据块的拼接。这里我们采用通用的尺寸1920*108(16:9)。尺寸确立后，接下来要对展示层进行布局和页面的划分。这里的划分，主要根据我们之前定好的业务指标进行，核心业务指标安排在中间位置、占较大面积；其余的指标按优先级依次在核心指标周围展开。一般把有关联的指标让其相邻或靠近，把图表类型相近的指标放一起，这样能减少观者认知上的负担并提高信息传递的效率。</p>
<p>对于这种块状(网格)布局，我们就可以使用我们强大的 CSS 布局方案 – <strong>Grid</strong>。它将网页划分成一个个网格，可以任意组合不同的网格，做出各种各样的布局。</p>
<p>安利一个grid 布局可视化设计工具 – <a href="https://cssgrid-generator.netlify.com/" target="_blank" rel="noopener">CSS Grid Generator</a>。可以使用它生成对应的代码，帮助咱们快速布局。</p>
<p><img src="https://raw.githubusercontent.com/hzzly/hzzly.github.io/master/images/bi/img2.png" alt="grid"></p>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>聊完这些通用知识我们就可以上手开发了。</p>
<p>我这里使用了我自己开发的脚手架（hzzly-cli）来生成react项目环境。</p>
<blockquote>
<p>有兴趣了解脚手架开发的可以看我这篇文章<a href="http://hjingren.cn/2019/07/19/%E5%8A%A8%E6%89%8B%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AE%E8%84%9A%E6%89%8B%E6%9E%B6/" target="_blank" rel="noopener">动手开发一个自己的项目脚手架</a></p>
</blockquote>
<p>项目结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">├── src</span><br><span class="line">│   ├── assets // 资源目录</span><br><span class="line">│   ├── components // 公共组件目录</span><br><span class="line">│   │   ├── Card // Card组件</span><br><span class="line">│   │   ├── Charts // 图表组件目录</span><br><span class="line">│   │   │   ├── Bar // 柱状图</span><br><span class="line">│   │   │   ├── ChinaMap // 中国地图</span><br><span class="line">│   │   │   ├── Funnel // 漏斗图</span><br><span class="line">│   │   │   ├── Line // 折线图</span><br><span class="line">│   │   │   ├── Pie // 饼图</span><br><span class="line">│   │   │   └── lib // 基础图表组件</span><br><span class="line">│   │   ├── ScrollNumber // 滚动数字组件</span><br><span class="line">│   │   └── SvgIcon // Icon组件</span><br><span class="line">│   ├── global.scss</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── pages // 分块结构目录</span><br><span class="line">│   ├── router // 路由</span><br><span class="line">│   ├── store</span><br><span class="line">│   │   ├── actions</span><br><span class="line">│   │   ├── index.js</span><br><span class="line">│   │   ├── reducers</span><br><span class="line">│   │   ├── sagas</span><br><span class="line">│   │   └── types.js</span><br><span class="line">│   └── utils</span><br><span class="line">│       ├── genChartData.js</span><br><span class="line">│       ├── genMapData.js</span><br><span class="line">│       ├── socket.js</span><br><span class="line">│       └── util.js</span><br></pre></td></tr></table></figure>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Chart基础组件封装"><a href="#Chart基础组件封装" class="headerlink" title="Chart基础组件封装"></a>Chart基础组件封装</h3><p>这里对<code>echarts-for-react</code>进一步封装，其它图表组件可以直接继承使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Charts/lib/BaseChart.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; PureComponent &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> Echarts <span class="keyword">from</span> <span class="string">'echarts-for-react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseChart</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    option: PropTypes.object.isRequired,</span><br><span class="line">    data: PropTypes.object.isRequired,</span><br><span class="line">    getOption: PropTypes.func.isRequired,</span><br><span class="line">    style: PropTypes.object,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    style: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; runAction &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.chartRef &amp;&amp; runAction) &#123;</span><br><span class="line">      <span class="keyword">const</span> chartIns = <span class="keyword">this</span>.chartRef.getEchartsInstance();</span><br><span class="line">      <span class="built_in">window</span>.setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        runAction(chartIns);</span><br><span class="line">      &#125;, <span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; option, data, getOption, style &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> finalOption = getOption(option, data);</span><br><span class="line">    <span class="keyword">const</span> finalStyle = getStyle(style);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Echarts</span><br><span class="line">        ref=&#123;ref =&gt; &#123;</span><br><span class="line">          <span class="keyword">this</span>.chartRef = ref;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        style=&#123;finalStyle&#125;</span><br><span class="line">        option=&#123;finalOption&#125;</span><br><span class="line">        notMerge</span><br><span class="line">        lazyUpdate</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">style</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123; <span class="attr">position</span>: <span class="string">'relative'</span> &#125;,</span><br><span class="line">    style</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// line.js</span></span><br><span class="line"><span class="keyword">import</span> BaseChart <span class="keyword">from</span> <span class="string">'../lib/BaseChart'</span>;</span><br><span class="line"><span class="keyword">import</span> option <span class="keyword">from</span> <span class="string">'./option'</span>;</span><br><span class="line"><span class="keyword">import</span> getOption <span class="keyword">from</span> <span class="string">'./getOption'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Line</span> <span class="keyword">extends</span> <span class="title">BaseChart</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    option,</span><br><span class="line">    getOption,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// option.js 基础配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getOption.js 计算配置文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">seriesCreator</span>(<span class="params">series</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> series.map(<span class="function"><span class="params">e</span> =&gt;</span> (&#123;</span><br><span class="line">    type: <span class="string">'line'</span>,</span><br><span class="line">    symbol: <span class="string">'circle'</span>,</span><br><span class="line">    smooth: <span class="literal">true</span>,</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      normal: &#123;</span><br><span class="line">        width: <span class="number">3</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    ...e,</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">option, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; tooltip, xAxis, yAxis, yCategory, series = [], ...rest &#125; = data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...option,</span><br><span class="line">    xAxis: &#123;</span><br><span class="line">      ...option.xAxis,</span><br><span class="line">      ...xAxis,</span><br><span class="line">    &#125;,</span><br><span class="line">    tooltip: &#123;</span><br><span class="line">      ...option.tooltip,</span><br><span class="line">      ...tooltip,</span><br><span class="line">    &#125;,</span><br><span class="line">    yAxis: &#123;</span><br><span class="line">      ...option.yAxis,</span><br><span class="line">      ...yAxis,</span><br><span class="line">      data: yCategory || [],</span><br><span class="line">    &#125;,</span><br><span class="line">    series: seriesCreator(series),</span><br><span class="line">    ...rest,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Socket封装SDK"><a href="#Socket封装SDK" class="headerlink" title="Socket封装SDK"></a>Socket封装SDK</h3><p>这里对<code>socket.io-client</code>封装成SDK，方便使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">'socket.io-client'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> socket = &#123;</span><br><span class="line">  wsConn: <span class="literal">null</span>,</span><br><span class="line">  config: &#123;</span><br><span class="line">    wsHost: <span class="string">'/'</span>, <span class="comment">// wesocket host</span></span><br><span class="line"></span><br><span class="line">    onConn() &#123;&#125;,</span><br><span class="line">    onDisconn() &#123;&#125;,</span><br><span class="line">    onError() &#123;&#125;,</span><br><span class="line">    onReceiveMsg() &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  init(opt) &#123;</span><br><span class="line">    socket.config = &#123; ...socket.config, ...opt &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getWs() &#123;</span><br><span class="line">    <span class="keyword">if</span> (socket.wsConn) &#123;</span><br><span class="line">      <span class="keyword">return</span> socket.wsConn;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      socket.initWs();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getWsStatus() &#123;</span><br><span class="line">    <span class="keyword">return</span> socket.wsConn ? socket.wsConn.connected : <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  initWs() &#123;</span><br><span class="line">    <span class="keyword">if</span> (socket.getWsStatus()) &#123;</span><br><span class="line">      <span class="keyword">return</span> socket.wsConn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wsUrl = socket.config.wsHost;</span><br><span class="line"></span><br><span class="line">    socket.wsConn = io.connect(wsUrl);</span><br><span class="line">    socket.wsConn.on(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">      socket.config.onConn(socket.wsConn);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    socket.wsConn.on(<span class="string">'message'</span>, (...param) =&gt; &#123;</span><br><span class="line">      socket.config.onReceiveMsg(...param);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    socket.wsConn.on(<span class="string">'disconnect'</span>, () =&gt; &#123;</span><br><span class="line">      socket.config.onDisconn();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> socket.wsConn;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reconnect() &#123;</span><br><span class="line">    <span class="keyword">if</span> (socket.wsConn) &#123;</span><br><span class="line">      <span class="keyword">if</span> (socket.wsConn.disconnected) &#123;</span><br><span class="line">        <span class="comment">// reconnect ws</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      socket.initWs();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  disconnect() &#123;</span><br><span class="line">    <span class="keyword">if</span> (socket.wsConn) &#123;</span><br><span class="line">      <span class="keyword">if</span> (socket.wsConn.connected) &#123;</span><br><span class="line">        socket.wsConn.disconnect();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  wsEmit(params) &#123;</span><br><span class="line">    <span class="keyword">if</span> (socket.wsConn) &#123;</span><br><span class="line">      socket.wsConn.emit(params.name, params.data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global</span>) </span>&#123;</span><br><span class="line">  global.socket = socket;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; socket &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="动态数字展示"><a href="#动态数字展示" class="headerlink" title="动态数字展示"></a>动态数字展示</h3><p>该数据通过socket推送实时更新。</p>
<p>数字过渡的动态效果为对应数位的新数字从下至上替换旧数字，如果该位数的数字没有发生变化，则没有过渡效果。</p>
<p><code>1、对数据进行完善并格式化</code></p>
<p>针对数字少于9位数进行前位补零并进行千分位格式化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MAX_LEN = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toThousands</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> num = (val || <span class="number">0</span>).toString();</span><br><span class="line">  <span class="keyword">while</span> (num.length &lt; MAX_LEN) &#123;</span><br><span class="line">    num = <span class="string">`0<span class="subst">$&#123;num&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">while</span> (num.length &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    result = <span class="string">`,<span class="subst">$&#123;num.slice(<span class="number">-3</span>)&#125;</span><span class="subst">$&#123;result&#125;</span>`</span>;</span><br><span class="line">    num = num.slice(<span class="number">0</span>, num.length - <span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (num) &#123;</span><br><span class="line">    result = num + result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result.toString().split(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>2、过渡动画</code></p>
<p>利用样式控制过渡动画，在第一步中我们对数字进行了格式化，然后我们针对每一位数字进行比较，当数字不相等的时候添加<code>active</code>类，最后对<code>active</code>类添加动画。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 循环渲染每一位数字</span></span><br><span class="line">&lt;li className=&#123;<span class="string">`<span class="subst">$&#123;oldNumber[i] !== newNumber[i] ? <span class="string">'active'</span> : <span class="string">''</span>&#125;</span>`</span>&#125;&gt;</span><br><span class="line">  &lt;span className=<span class="string">"num"</span>&gt;&#123;oldNumber[i]&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;span className="num"&gt;&#123;newNumber[i]&#125;&lt;/</span>span&gt;</span><br><span class="line">&lt;<span class="regexp">/li&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.active</span> &#123;</span><br><span class="line">  .num &#123;</span><br><span class="line">    <span class="selector-tag">animation</span>: <span class="selector-tag">move</span> 1<span class="selector-class">.5s</span>;</span><br><span class="line">    animation-fill-mode: forwards; // 让动画结束后保持最后一帧</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> move &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(0);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-100%);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="背景线性粒子"><a href="#背景线性粒子" class="headerlink" title="背景线性粒子"></a>背景线性粒子</h3><p>这里我使用了我自己封装的组件，可以对应框架来安装引用：</p>
<ul>
<li><a href="https://github.com/hzzly/vue-particle-line" target="_blank" rel="noopener">vue-particle-line</a></li>
<li><a href="https://github.com/hzzly/react-particle-line" target="_blank" rel="noopener">react-particle-line</a></li>
</ul>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>1、项目框架目录结构采用笔者自己搭建的webpack环境：<a href="https://github.com/hzzly/webpack-template" target="_blank" rel="noopener">webpack-template</a></p>
<p>2、关于适配和兼容性暂时还未完善，如果后期有时间会慢慢去完善</p>
<p>3、此项目为笔者调研时的实践，因为时间有限，一些功能还不善，设计和布局都是自己的一些想象与参考</p>
<p>4、此项目作为开源学习使用，谢绝用于商业应用</p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>代码已上传至我的<a href="https://github.com/hzzly/credit-bi-react" target="_blank" rel="noopener">GitHub</a>，欢迎 Star、Fork</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.woshipm.com/pd/1782868.html" target="_blank" rel="noopener">超全面设计指南：如何做大屏数据可视化设计？</a></li>
<li><a href="http://www.woshipm.com/data-analysis/2279512.html" target="_blank" rel="noopener">五个方面，聊聊大数据可视化的初体验</a></li>
<li><a href="https://juejin.im/post/5a20fe96f265da431120025b" target="_blank" rel="noopener">一个炫酷大屏展示页的打造过程</a></li>
</ul>

    
  </div>

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持hzzly</div>
        <ul>
        
          <li class="item">
            
              <span>微信扫一扫</span>
            
            <img src="" alt="">
          </li>
        
          <li class="item">
            
              <span>支付宝扫一扫</span>
            
            <img src="" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2019/09/19/AST的实践/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/archives/" rel="noopener noreferrer" target="_self">
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/" rel="noopener noreferrer" target="_self">
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/" rel="noopener noreferrer" target="_self">
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/" rel="noopener noreferrer" target="_self">
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/atom.xml" rel="noopener noreferrer" target="_blank">
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/search/" rel="noopener noreferrer" target="_self">
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
